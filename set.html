<!DOCTYPE html>
<html lang=nl>
<head>
	<meta charset=utf-8>
	<meta name=description content="Beschrijving van de webpagina">
	<meta name=keywords content="trefwoord1, trefwoord2">
	<title>titelman</title>
</head>
<body>
<h2>set!</h2>
<h3>game Board:</h3>
<div id ="gameBoard">
</div>
<h3>Chosen cards:</h3>
<div id ="selectedCards">
</div>
<h3>Combinations:</h3>
<table id = "combiTable" style="width:100%">

</table>
<div id ="Combinations">
</div>
<h3>Deck:</h3>
<div id ="allCards">
</div>
</body>
<script>
const MAX_SET_SIZE = 3;
const colorName = ["red","green","purple"];
const shapeName = ["squiggle","diamond","oval"];
const amountName = ["1","2","3"];
const fillName = ["open","striped","full"];


const deck = [];
const discardPile = [];
let gameBoard = [];
let selectedCards = [];

let i=0;

const cards = amountName
	.flatMap(amount => colorName
		.flatMap(color =>  fillName
			.flatMap(fill => shapeName
				.map(shape => {
					return {id:i++, amount:amount, color:color, fill:fill, shape:shape}
		}))));

const getCardString = (c) => `<p onclick=selectCard(${c.id}) id=card_${c.id}>(${c.id}) ${c.amount} ${c.color} ${c.fill} ${c.shape}</p>`

const getStackString = (cardArray,breakString) => {
	return cardArray.
		map( (card) => (getCardString(card) + breakString) ).
			reduce ( (a,b) => a + b);
}

const getStackCells = (cardArray) => {
	return cardArray.
		map( (card) => (getCardCell(card) ) ).
			reduce ( (a,b) => a + b);
}

const getCardCell = (c) => `<td>(${c.id}) ${c.amount}</td><td>${c.color}</td><td>${c.fill}</td><td>${c.shape}</td>`

const shuffle = () => {
	cards.map( (v,k) => {
		let random = Math.floor(Math.random() * cards.length);
		let newV = cards[random];
		cards[random] = v;
		return newV;
	})
}

const display = (array,element) => {
	document.getElementById(element).innerHTML = getStackString(array,"")
}

const combiDisplay = (array, element) => {
	array.forEach(combi => document.getElementById(element).innerHTML += getStackString(combi," & ") + "<br>" );
}

const combiColPlace = (array, element) => {
	array.forEach(combi => document.getElementById(element).innerHTML += "<tr>" + getStackCells(combi) + "</tr>" );
}

const pickCards = (number) => {
	 return cards.splice(0,number);
}

const combinations = (cardArray) => {
	return cardArray
		.flatMap( (a, i) => cardArray
			.slice(i+1)
				.flatMap( (b,i2) => cardArray
					.slice(i2+2+i)
						.map( (c) => [a,b,c])
				)
		);
}

const validcombinations = (combiArray) => {
	return combiArray.filter( (combi) => isValidCombi(combi) );
}

const isValidCombi = (combi) => {

	let result =
	( ( (combi[0].amount == combi[1].amount) && (combi[1].amount == combi[2].amount) )
	||
	( (combi[0].amount != combi[1].amount) && (combi[1].amount != combi[2].amount) &&
	(combi[0].amount != combi[2].amount) ) ) &&

	( ( (combi[0].color == combi[1].color) && (combi[1].color == combi[2].color) )
	||
	( (combi[0].color != combi[1].color) && (combi[1].color != combi[2].color) &&
	(combi[0].color != combi[2].color) ) ) &&

	( ( (combi[0].fill == combi[1].fill) && (combi[1].fill == combi[2].fill) )
  ||
  ( (combi[0].fill != combi[1].fill) && (combi[1].fill != combi[2].fill) &&
  (combi[0].fill != combi[2].fill) ) ) &&

	( ( (combi[0].shape == combi[1].shape) && (combi[1].shape == combi[2].shape) )
  ||
	( (combi[0].shape != combi[1].shape) && (combi[1].shape != combi[2].shape) &&
	(combi[0].shape != combi[2].shape) ) )

	return result;

}

const play = () => {
	shuffle();
  	gameBoard = pickCards(12);
	display(gameBoard, "gameBoard");
	display(cards, "allCards");
	let combis = combinations(gameBoard);
	combis = validcombinations(combis);
	combiColPlace(combis,"combiTable")
	//combiTable
}

const selectCard = (cardId) => {
	if (selectedCards.length>=MAX_SET_SIZE)
	{
		return
	}
	let selectedCard = gameBoard.filter(e => e.id === cardId);
	let cardAlreadySelected = selectedCards.filter(e => e.id === cardId);
	if (cardAlreadySelected[0]) {
		gameBoard.push(cardAlreadySelected[0]);
		selectedCards = selectedCards.filter(e => e.id != cardId);//.remove(e => e.id === cardId);
		document.getElementById("card_"+cardId).style.fontWeight = "90";
	} else {
		selectedCards.push(selectedCard[0]);
		gameBoard = gameBoard.filter(e => e.id != cardId);
		//gameBoard.remove(e => e.id === cardId);
		document.getElementById("card_"+cardId).style.fontWeight = "900";
	}

	
	display(gameBoard, "gameBoard");
	display(selectedCards, "selectedCards");
	if (selectedCards.length==MAX_SET_SIZE)
	{
		let validSet = isValidCombi(selectedCards)
		if (validSet)
		{
			alert('goed man');
		} else {
			alert('je bent zelf een Set');
		}
	}

}

play();

/*
bool IsSet(cards[])
bool PlayfieldContainsSet()
void 
*/

</script>

</html>
